<!DOCTYPE html>
<!-- https://docs.mapbox.com/mapbox-gl-js/example/updating-choropleth/ -->
<html>

<head>
    <meta name="viewport" content="user-scalable = yes">
    <title>South End Transit Times: Link vs. Bus</title>
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">
    <link href="https://api.mapbox.com/mapbox-gl-js/v2.14.1/mapbox-gl.css" rel="stylesheet">
    <script src="https://api.mapbox.com/mapbox-gl-js/v2.14.1/mapbox-gl.js"></script>
</head>

<body>
    <style>
    @import url('https://fonts.googleapis.com/css2?family=Roboto&display=swap');
    
    
    body {
        margin: 0;
        padding: 0;
    }

    #map {
        position: absolute;
        top: 70px;
        bottom: 0px;
        width: 100%;
    }

    h3 {
        font-size: 16px;
        font-family: 'Roboto';
    }

    h2 {
        font-size: 24px;
        font-family: 'Roboto';
    }
    h4 {
        font-size: 14px;
        font-family: 'Roboto';
    }
    h5 {
        font-size: 8px;
        font-family: 'Roboto';
    }

    .map-title {
        font-family: 'Roboto';
        position: relative;
        text-align: center;
        font-size: 16px;
    }
    .legend {
        font-family: 'Roboto';
        position: fixed;
        border-radius: 10px;
        top: 90px;
        left: 10px;
        margin: 10px; 
        width: 175px;
        background-color: #fff;
        padding: 10px 10px;
        z-index: 1002;
        opacity: 1;
    }
    .data-selector {
        font-family: 'Roboto';
        position: fixed;
        border-radius: 10px;
        top: 90px;
        right: 10px;
        margin: 10px; 
        width: 120px;
        height: 320px;
        background-color: #fff;
        padding: 10px 10px;
        z-index: 1002;
        opacity: 1;
    }
    .drop-down-menu{
        font-family: 'Roboto';
        font-size: 12px;
        width: 100px;
    }

    .legend-box{
        float: left;
        height: 20px;
        width: 20px;
        margin-bottom: 15px;
        border: 1px solid black;
        clear: both;
    }
    .legend-dot{
        float: left;
        height: 10px;
        width: 10px;
        margin-bottom: 5px;
        background-color: #223b53;
        border: 1px solid white;
        clear: both;
        border-radius: 50%;
    }
    .c1 {
        background-color: #d95f0e;
    }

    .c2 {
        background-color: #fec44f;
    }

    .c3 {
        background-color: #fff7bc;
    }

        .row {
        height: 12px;
        width: 100%;
    }

    .colors {
        background: linear-gradient(to right,
            #762a83,
            #af8dc3,
            #e7d4e8,
            #f7f7f7,
            #d9f0d3,
            #7fbf7b,
            #1b7837);
        margin-bottom: 5px;
    }

    .label {
        width: 30%;
        display: inline-block;
        text-align: center;
        font-family: 'Roboto';
    }

    .full_screen {
        font-family: 'Roboto';
        position: fixed;
        border-radius: 10px;
        bottom: 12px;
        right: 10px;
        margin: 10px;
        /*        width: 120px;*/
        background-color: #fff;
        padding: 10px 10px;
        z-index: 1002;
    }

    </style>
    <!-- Load the `mapbox-gl-geocoder` plugin. -->
    <script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v5.0.0/mapbox-gl-geocoder.min.js"></script>
    <link rel="stylesheet" href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v5.0.0/mapbox-gl-geocoder.css" type="text/css">
    <div id="map-title" class="map-title"><h1>South End Transit: Rail vs. Bus</h1></div>
    <div id="map-legend" class="legend">
        <div id="legend-title" class="h2"><b>Legend</b></div>
        <hr>
        <div id="data-selection">
            <label for="chinatown-region">Select a part of Chinatown/International District:</label>
            <select name="chinatown-region" id="chinatown-region" class="drop-down-menu">
                <option value="99">All</option>
                <option value="0">6th and King</option>
                <option value="1">7th and King</option>
                <option value="2">6th and Lane</option>
                <option value="3">7th and Lane</option>
            </select>
        </div>
        <hr>
        <div id="south-end-marker-text"><i>Click on a hexagon to show details for a specific part of Seattle's South End</i></div>
        <hr>
        <div class="row colors"></div>
        <div class="row labels">
            <div class="label"><small>Prefer Bus</small></div>
            <div class="label"> </div>
            <div class="label"><small>Prefer Link</small></div>
        </div>
        <br><hr>
        <div id="link-display">
            <input type="checkbox" id="show-link" name="link" value="show-link">
            <label for="link">Show route</label><br>
            <input type="checkbox" id="show-link-labels" name="link-labels" value="show-link-labels">
            <label for="link-labels">Show labels</label><br>
        </div>
    </div>
    <div id="map"></div>
    <pre id="coordinates" class="coordinates"></pre>
    <!-- Initialize Map -->
    <script>

    
	mapboxgl.accessToken = 'pk.eyJ1IjoiYmx1bWRyZXciLCJhIjoiY203bnZqcmc1MDU3czJtcHVtOWtuejg3cyJ9.BtyyyhiVLkUXZJP06fW7Aw';
    const coordinates = document.getElementById('coordinates');
    const map = new mapboxgl.Map({
        container: 'map',
        style: 'mapbox://styles/mapbox/dark-v11',
        center: [-122.28, 47.55],
        minZoom: 10,
        zoom: 12,
        attributionControl: false
    });
    const southEndLink = {
    type: 'FeatureCollection',
    features: [
        {type: 'Feature',geometry: {type: 'Point',coordinates: [-122.32807, 47.59843]},
        properties: {title: 'Link Station',description: 'Chinatown/International District'}},
        {type: 'Feature',geometry: {type: 'Point',coordinates: [-122.32718,47.591098]},
        properties: {title: 'Link Station',description: 'Stadium'}},
        {type: 'Feature',geometry: {type: 'Point',coordinates: [-122.32744,47.581186]},
        properties: {title: 'Link Station',description: 'SODO'}},
        {type: 'Feature',geometry: {type: 'Point',coordinates: [-122.31197,47.579014]},
        properties: {title: 'Link Station',description: 'Beacon Hill'}},
        {type: 'Feature',geometry: {type: 'Point',coordinates: [-122.29771,47.576550]},
        properties: {title: 'Link Station',description: 'Mount Baker'}},
        {type: 'Feature',geometry: {type: 'Point',coordinates: [-122.29311,47.560345]},
        properties: {title: 'Link Station',description: 'Columbia City'}},
        {type: 'Feature',geometry: {type: 'Point',coordinates: [-122.28160,47.538057]},
        properties: {title: 'Link Station',description: 'Othello'}},
        {type: 'Feature',geometry: {type: 'Point',coordinates: [-122.27938,47.522393]},
        properties: {title: 'Link Station',description: 'Rainier Beach'}},
    ]
    };
    const linkRoute = {
        type:"FeatureCollection",
        features:[
            {type:'Feature',geometry:{type:'LineString',coordinates:[[-122.295179, 47.815455], [-122.295999, 47.814976], [-122.296267, 47.814805], [-122.296526, 47.814627], [-122.296706, 47.814496], [-122.296898, 47.814342], [-122.297077, 47.814181], [-122.297244, 47.814014], [-122.297348, 47.8139], [-122.297492, 47.813724], [-122.297581, 47.813605], [-122.297702, 47.813421], [-122.297825, 47.813206], [-122.298459, 47.812029], [-122.298547, 47.811882], [-122.298658, 47.811712], [-122.298778, 47.811546], [-122.298908, 47.811382], [-122.299047, 47.811222], [-122.299194, 47.811065], [-122.299351, 47.810913], [-122.299515, 47.810764], [-122.299689, 47.81062], [-122.299869, 47.81048], [-122.300058, 47.810345], [-122.300254, 47.810215], [-122.300493, 47.81007], [-122.300783, 47.809907], [-122.310646, 47.804639], [-122.311099, 47.804387], [-122.311417, 47.804194], [-122.311726, 47.803994], [-122.312023, 47.803787], [-122.312449, 47.803463], [-122.31543, 47.800988], [-122.315631, 47.800809], [-122.315794, 47.80064], [-122.315952, 47.800443], [-122.316084, 47.800236], [-122.31617, 47.800066], [-122.316252, 47.799849], [-122.316298, 47.799672], [-122.316327, 47.799468], [-122.316335, 47.799181], [-122.316302, 47.796626], [-122.316306, 47.796351], [-122.316318, 47.796104], [-122.316337, 47.795857], [-122.316399, 47.795366], [-122.316456, 47.795044], [-122.316705, 47.793809], [-122.316775, 47.79338], [-122.316802, 47.793164], [-122.316823, 47.792949], [-122.316846, 47.792584], [-122.316914, 47.791063], [-122.316913, 47.790776], [-122.316886, 47.790569], [-122.31683, 47.790354], [-122.316746, 47.790143], [-122.31666, 47.789978], [-122.316557, 47.789817], [-122.316456, 47.789684], [-122.315934, 47.789065], [-122.315805, 47.788903], [-122.315698, 47.788746], [-122.315584, 47.788537], [-122.315529, 47.788407], [-122.315468, 47.78824], [-122.315037, 47.786981], [-122.314963, 47.786747], [-122.31491, 47.786518], [-122.314891, 47.786379], [-122.314875, 47.786101], [-122.31485, 47.783942], [-122.314862, 47.78373], [-122.314893, 47.783564], [-122.314924, 47.783465], [-122.314963, 47.783367], [-122.315064, 47.78318], [-122.315818, 47.782033], [-122.315917, 47.781875], [-122.316046, 47.781651], [-122.316164, 47.781424], [-122.31627, 47.781194], [-122.316363, 47.780961], [-122.316445, 47.780727], [-122.316514, 47.780491], [-122.31659, 47.780167], [-122.317475, 47.775786], [-122.317536, 47.775554], [-122.317597, 47.775356], [-122.317667, 47.775159], [-122.317745, 47.774964], [-122.317832, 47.774771], [-122.317927, 47.77458], [-122.318031, 47.77439], [-122.318143, 47.774203], [-122.318263, 47.774018], [-122.318407, 47.773815], [-122.320846, 47.770678], [-122.321102, 47.770331], [-122.321248, 47.770111], [-122.321444, 47.769775], [-122.321614, 47.769433], [-122.321713, 47.769201], [-122.321838, 47.76885], [-122.321945, 47.768455], [-122.323147, 47.763057], [-122.323231, 47.762766], [-122.323289, 47.762612], [-122.323356, 47.762459], [-122.323431, 47.762309], [-122.323515, 47.76216], [-122.323608, 47.762014], [-122.323709, 47.76187], [-122.323872, 47.761665], [-122.327756, 47.757308], [-122.328052, 47.756952], [-122.328305, 47.756603], [-122.328458, 47.756366], [-122.32856, 47.756196], [-122.329014, 47.755372], [-122.329171, 47.755071], [-122.329318, 47.754739], [-122.329402, 47.754515], [-122.329474, 47.754289], [-122.32956, 47.753947], [-122.32962, 47.753603], [-122.329653, 47.753257], [-122.329659, 47.75291], [-122.329638, 47.752564], [-122.32959, 47.752218], [-122.329515, 47.751875], [-122.329451, 47.751648], [-122.329348, 47.751351], [-122.328784, 47.749971], [-122.328651, 47.749605], [-122.328589, 47.749394], [-122.328536, 47.749181], [-122.328493, 47.748968], [-122.328461, 47.748753], [-122.328438, 47.748538], [-122.328426, 47.748323], [-122.328424, 47.748107], [-122.328431, 47.747892], [-122.328449, 47.747677], [-122.328478, 47.747462], [-122.328516, 47.747248], [-122.328564, 47.747035], [-122.328678, 47.746643], [-122.329259, 47.744919], [-122.329335, 47.744648], [-122.329392, 47.744361], [-122.329427, 47.744073], [-122.329438, 47.74388], [-122.329439, 47.743688], [-122.32943, 47.743495], [-122.329411, 47.743302], [-122.329382, 47.74311], [-122.329344, 47.742919], [-122.329295, 47.742729], [-122.329204, 47.742446], [-122.329091, 47.742167], [-122.328956, 47.741893], [-122.328798, 47.741618], [-122.324823, 47.735322], [-122.324654, 47.735064], [-122.324217, 47.734422], [-122.324071, 47.73418], [-122.323996, 47.734032], [-122.323931, 47.733883], [-122.323876, 47.733731], [-122.323831, 47.733578], [-122.323796, 47.733424], [-122.32377, 47.733269], [-122.323753, 47.733102], [-122.323689, 47.732229], [-122.323675, 47.731937], [-122.323673, 47.731574], [-122.323751, 47.726426], [-122.323763, 47.725965], [-122.323898, 47.722419], [-122.323904, 47.722076], [-122.323892, 47.721596], [-122.323818, 47.72036], [-122.323813, 47.719968], [-122.323861, 47.71878], [-122.323884, 47.718555], [-122.323916, 47.718331], [-122.32396, 47.718107], [-122.324014, 47.717885], [-122.324078, 47.717664], [-122.324153, 47.717444], [-122.324238, 47.717226], [-122.324333, 47.71701], [-122.324438, 47.716796], [-122.324554, 47.716585], [-122.324679, 47.716376], [-122.324814, 47.716169], [-122.324974, 47.715946], [-122.325753, 47.714953], [-122.325885, 47.714775], [-122.325993, 47.714619], [-122.326174, 47.714322], [-122.326691, 47.713404], [-122.326882, 47.713103], [-122.327003, 47.712935], [-122.327149, 47.712748], [-122.328185, 47.711486], [-122.328359, 47.71125], [-122.328526, 47.710991], [-122.328626, 47.710816], [-122.328759, 47.710548], [-122.328836, 47.710367], [-122.328903, 47.710185], [-122.328961, 47.710001], [-122.32901, 47.709815], [-122.329049, 47.709629], [-122.329078, 47.709442], [-122.329109, 47.709079], [-122.329155, 47.708001], [-122.329151, 47.707694], [-122.329125, 47.707384], [-122.329074, 47.707075], [-122.329026, 47.70687], [-122.328969, 47.706666], [-122.328886, 47.706421], [-122.32857, 47.70555], [-122.328505, 47.705348], [-122.328467, 47.705203], [-122.32842, 47.704947], [-122.328406, 47.704816], [-122.328391, 47.704474], [-122.328358, 47.70182], [-122.328366, 47.701474], [-122.328381, 47.701292], [-122.328419, 47.701029], [-122.32878, 47.699074], [-122.328815, 47.6988], [-122.328835, 47.698568], [-122.328844, 47.698336], [-122.328844, 47.698104], [-122.328833, 47.697872], [-122.328811, 47.69764], [-122.328617, 47.696273], [-122.328577, 47.695879], [-122.328569, 47.695663], [-122.32857, 47.695455], [-122.328639, 47.692156], [-122.328631, 47.691935], [-122.328613, 47.691713], [-122.328584, 47.691492], [-122.328546, 47.691271], [-122.328497, 47.691052], [-122.328438, 47.690833], [-122.328369, 47.690616], [-122.328291, 47.690401], [-122.328202, 47.690187], [-122.328104, 47.689975], [-122.327996, 47.689765], [-122.327879, 47.689558], [-122.327752, 47.689353], [-122.327616, 47.689151], [-122.327471, 47.688952], [-122.327316, 47.688756], [-122.327153, 47.688563], [-122.326981, 47.688374], [-122.326801, 47.688189], [-122.326612, 47.688007], [-122.326415, 47.687829], [-122.326176, 47.687627], [-122.317976, 47.680827], [-122.31768, 47.680576], [-122.317412, 47.680327], [-122.317263, 47.680173], [-122.317121, 47.680016], [-122.316988, 47.679855], [-122.316864, 47.679691], [-122.316749, 47.679524], [-122.316642, 47.679354], [-122.316545, 47.679182], [-122.316457, 47.679008], [-122.316378, 47.678831], [-122.316309, 47.678653], [-122.316249, 47.678473], [-122.316199, 47.678292], [-122.316159, 47.67811], [-122.316128, 47.677927], [-122.316105, 47.677719], [-122.316092, 47.677472], [-122.31606, 47.675578], [-122.31603, 47.675177], [-122.316005, 47.674977], [-122.314435, 47.665652], [-122.314354, 47.665049], [-122.314299, 47.664571], [-122.314255, 47.664092], [-122.314221, 47.663613], [-122.314198, 47.663134], [-122.314184, 47.662654], [-122.314181, 47.662174], [-122.314247, 47.659425], [-122.314242, 47.659298], [-122.314228, 47.659176], [-122.314205, 47.659055], [-122.314172, 47.658935], [-122.314129, 47.658816], [-122.314077, 47.658699], [-122.314016, 47.658584], [-122.313945, 47.658471], [-122.313866, 47.658362], [-122.313778, 47.658255], [-122.313682, 47.658152], [-122.313577, 47.658052], [-122.313465, 47.657956], [-122.313345, 47.657865], [-122.313218, 47.657778], [-122.313085, 47.657695], [-122.312944, 47.657618], [-122.312798, 47.657546], [-122.312647, 47.657479], [-122.31249, 47.657418], [-122.312329, 47.657363], [-122.312163, 47.657314], [-122.311994, 47.657271], [-122.311799, 47.65723], [-122.311571, 47.657191], [-122.309087, 47.656828], [-122.308768, 47.656777], [-122.308515, 47.656731], [-122.308272, 47.656681], [-122.308032, 47.656623], [-122.307796, 47.656559], [-122.307564, 47.656489], [-122.307336, 47.656413], [-122.307113, 47.65633], [-122.306895, 47.656242], [-122.306683, 47.656148], [-122.306476, 47.656048], [-122.306276, 47.655942], [-122.306082, 47.655831], [-122.305894, 47.655715], [-122.305714, 47.655594], [-122.305541, 47.655468], [-122.305376, 47.655338], [-122.305218, 47.655203], [-122.305069, 47.655064], [-122.304928, 47.654921], [-122.304795, 47.654774], [-122.304672, 47.654624], [-122.304558, 47.654471], [-122.304452, 47.654314], [-122.304356, 47.654155], [-122.30427, 47.653994], [-122.304193, 47.65383], [-122.304126, 47.653664], [-122.304069, 47.653497], [-122.304022, 47.653328], [-122.303985, 47.653158], [-122.303953, 47.652943], [-122.303933, 47.652678], [-122.303838, 47.649351], [-122.303792, 47.647527], [-122.303787, 47.647014], [-122.303795, 47.646639], [-122.303815, 47.646265], [-122.303844, 47.64589], [-122.303885, 47.645516], [-122.303936, 47.645142], [-122.303997, 47.64477], [-122.304069, 47.644398], [-122.304151, 47.644027], [-122.304244, 47.643657], [-122.304347, 47.643288], [-122.30446, 47.642921], [-122.304584, 47.642556], [-122.304718, 47.642192], [-122.304862, 47.641829], [-122.305017, 47.641469], [-122.305181, 47.641111], [-122.305356, 47.640755], [-122.30554, 47.640401], [-122.305734, 47.64005], [-122.305938, 47.639701], [-122.306152, 47.639355], [-122.306376, 47.639011], [-122.306609, 47.638671], [-122.306852, 47.638334], [-122.307104, 47.638], [-122.307425, 47.637597], [-122.318955, 47.623523], [-122.319226, 47.62317], [-122.319382, 47.622943], [-122.319526, 47.622712], [-122.319658, 47.622479], [-122.319778, 47.622242], [-122.319886, 47.622003], [-122.319981, 47.621761], [-122.320064, 47.621517], [-122.320134, 47.621271], [-122.320191, 47.621024], [-122.320236, 47.620776], [-122.320279, 47.620401], [-122.320292, 47.620063], [-122.320261, 47.61798], [-122.320263, 47.61774], [-122.320279, 47.617516], [-122.320303, 47.61734], [-122.320338, 47.617164], [-122.320384, 47.61699], [-122.32044, 47.616817], [-122.320506, 47.616646], [-122.320582, 47.616477], [-122.320669, 47.616309], [-122.320765, 47.616145], [-122.320871, 47.615983], [-122.320987, 47.615825], [-122.321112, 47.615669], [-122.321246, 47.615517], [-122.32139, 47.615369], [-122.321542, 47.615225], [-122.321702, 47.615085], [-122.321871, 47.61495], [-122.322048, 47.61482], [-122.322232, 47.614694], [-122.322424, 47.614573], [-122.322623, 47.614458], [-122.322828, 47.614349], [-122.32304, 47.614245], [-122.323258, 47.614147], [-122.323482, 47.614055], [-122.323711, 47.613969], [-122.323945, 47.61389], [-122.324183, 47.613817], [-122.324426, 47.613751], [-122.324673, 47.613691], [-122.324922, 47.613638], [-122.325175, 47.613592], [-122.32543, 47.613553], [-122.325688, 47.613521], [-122.325947, 47.613496], [-122.326207, 47.613478], [-122.326469, 47.613468], [-122.32673, 47.613464], [-122.326992, 47.613468], [-122.327253, 47.613479], [-122.327513, 47.613497], [-122.327772, 47.613522], [-122.32803, 47.613554], [-122.328285, 47.613593], [-122.328538, 47.613639], [-122.328741, 47.613681], [-122.329716, 47.613901], [-122.329912, 47.613936], [-122.330061, 47.613955], [-122.330211, 47.613967], [-122.330363, 47.613972], [-122.330515, 47.61397], [-122.330666, 47.613961], [-122.330815, 47.613945], [-122.330963, 47.613923], [-122.331109, 47.613893], [-122.331266, 47.613852], [-122.331463, 47.613788], [-122.331673, 47.613705], [-122.33549, 47.612109], [-122.336083, 47.61188], [-122.337899, 47.611117], [-122.338008, 47.61106], [-122.338105, 47.610996], [-122.33819, 47.610924], [-122.338254, 47.610853], [-122.338306, 47.610778], [-122.338348, 47.610691], [-122.338372, 47.61061], [-122.338382, 47.610518], [-122.338369, 47.610399], [-122.338328, 47.610283], [-122.338264, 47.610179], [-122.338156, 47.610047], [-122.336942, 47.608719], [-122.336556, 47.608328], [-122.335652, 47.607341], [-122.335524, 47.607196], [-122.335216, 47.60683], [-122.332172, 47.603504], [-122.332035, 47.603359], [-122.331753, 47.603079], [-122.330709, 47.601939], [-122.330564, 47.601804], [-122.330386, 47.601671], [-122.328817, 47.600661], [-122.32867, 47.600562], [-122.328573, 47.600489], [-122.328488, 47.600416], [-122.328409, 47.60034], [-122.328282, 47.60019], [-122.328181, 47.600032], [-122.328137, 47.599943], [-122.328102, 47.599854], [-122.328058, 47.599684], [-122.328041, 47.599488], [-122.328048, 47.597823], [-122.328053, 47.597746], [-122.328067, 47.597684], [-122.328097, 47.59761], [-122.328194, 47.597412], [-122.328213, 47.597351], [-122.328221, 47.59729], [-122.328203, 47.595884], [-122.328186, 47.595613], [-122.328165, 47.595474], [-122.328137, 47.595335], [-122.328062, 47.595078], [-122.327617, 47.593874], [-122.327319, 47.593089], [-122.327271, 47.592901], [-122.327252, 47.592711], [-122.327254, 47.589632], [-122.327263, 47.589496], [-122.32728, 47.589373], [-122.327393, 47.588785], [-122.327408, 47.588637], [-122.327413, 47.588483], [-122.327416, 47.579956], [-122.32742, 47.578486], [-122.327409, 47.578303], [-122.327394, 47.578231], [-122.327368, 47.578154], [-122.327332, 47.578085], [-122.327286, 47.578018], [-122.327238, 47.577962], [-122.327174, 47.577902], [-122.327092, 47.577841], [-122.327, 47.577786], [-122.3269, 47.577738], [-122.326792, 47.577699], [-122.326692, 47.577671], [-122.326575, 47.577648], [-122.326443, 47.57763], [-122.326255, 47.577614], [-122.324131, 47.577469], [-122.323824, 47.577454], [-122.323533, 47.57745], [-122.32114, 47.577449], [-122.32079, 47.577442], [-122.320629, 47.577432], [-122.320428, 47.577414], [-122.318918, 47.577241], [-122.318555, 47.577207], [-122.318292, 47.577194], [-122.318054, 47.577193], [-122.317815, 47.577201], [-122.317552, 47.577221], [-122.317266, 47.577256], [-122.316984, 47.577305], [-122.316707, 47.577368], [-122.316416, 47.577451], [-122.316042, 47.577579], [-122.313604, 47.578458], [-122.313109, 47.578628], [-122.312435, 47.578843], [-122.31021, 47.579529], [-122.309813, 47.579644], [-122.309555, 47.579707], [-122.309288, 47.57976], [-122.309017, 47.579802], [-122.308742, 47.579832], [-122.308465, 47.579851], [-122.308188, 47.579858], [-122.30791, 47.579853], [-122.30766, 47.579838], [-122.307358, 47.579808], [-122.307032, 47.579759], [-122.306739, 47.579699], [-122.306429, 47.579619], [-122.306036, 47.579497], [-122.30319, 47.578542], [-122.302837, 47.578435], [-122.302471, 47.57834], [-122.302029, 47.578244], [-122.30158, 47.578168], [-122.301261, 47.578126], [-122.299747, 47.577944], [-122.299548, 47.577917], [-122.299393, 47.577887], [-122.299253, 47.577852], [-122.299117, 47.57781], [-122.298986, 47.577762], [-122.298785, 47.57767], [-122.298602, 47.577562], [-122.29844, 47.57744], [-122.2983, 47.577306], [-122.298181, 47.577163], [-122.297208, 47.575884], [-122.297092, 47.575716], [-122.297004, 47.575557], [-122.296935, 47.575393], [-122.296891, 47.575241], [-122.296863, 47.575088], [-122.296852, 47.574918], [-122.296896, 47.572577], [-122.29692, 47.570664], [-122.296899, 47.568441], [-122.296911, 47.568129], [-122.296965, 47.567298], [-122.296971, 47.567122], [-122.296963, 47.566925], [-122.296937, 47.566729], [-122.296894, 47.566535], [-122.296834, 47.566342], [-122.296783, 47.566209], [-122.296714, 47.566058], [-122.296645, 47.565929], [-122.296558, 47.565784], [-122.290971, 47.556955], [-122.290376, 47.555986], [-122.290225, 47.555722], [-122.290088, 47.555443], [-122.28961, 47.554374], [-122.289395, 47.553914], [-122.288119, 47.551261], [-122.287283, 47.549551], [-122.285916, 47.546689], [-122.285283, 47.545426], [-122.283141, 47.54099], [-122.282929, 47.540566], [-122.281184, 47.537188], [-122.281055, 47.53692], [-122.280957, 47.536667], [-122.280883, 47.536411], [-122.280833, 47.536152], [-122.280808, 47.535901], [-122.280692, 47.5298], [-122.280675, 47.529526], [-122.280634, 47.529239], [-122.280588, 47.529025], [-122.280527, 47.528813], [-122.280453, 47.528603], [-122.280366, 47.528396], [-122.279149, 47.525979], [-122.279048, 47.525766], [-122.278982, 47.525593], [-122.27893, 47.525419], [-122.278888, 47.525223], [-122.278864, 47.525045], [-122.278855, 47.524867], [-122.278858, 47.524709], [-122.278875, 47.524531], [-122.278905, 47.524354], [-122.278953, 47.524168], [-122.279224, 47.52324], [-122.279896, 47.520722], [-122.279943, 47.520493], [-122.279974, 47.520272], [-122.279991, 47.520051], [-122.279994, 47.519829], [-122.279986, 47.519657], [-122.279971, 47.519485], [-122.279943, 47.519289], [-122.279909, 47.519118], [-122.27985, 47.518886], [-122.279547, 47.517832], [-122.279394, 47.517235], [-122.279284, 47.516745], [-122.279094, 47.515821], [-122.279055, 47.515603], [-122.279028, 47.515412], [-122.27892, 47.514488], [-122.278872, 47.513762], [-122.278844, 47.513456], [-122.278811, 47.513198], [-122.278686, 47.51239], [-122.278632, 47.512003], [-122.278484, 47.510769], [-122.278446, 47.510331], [-122.278416, 47.509472], [-122.278416, 47.50932], [-122.278425, 47.509175], [-122.278447, 47.509028], [-122.278486, 47.508881], [-122.278536, 47.50875], [-122.278608, 47.508608], [-122.278667, 47.508511], [-122.278745, 47.508404], [-122.278821, 47.508312], [-122.278916, 47.508211], [-122.279021, 47.508114], [-122.279134, 47.508022], [-122.279256, 47.507935], [-122.279369, 47.507863], [-122.279505, 47.507786], [-122.27963, 47.507724], [-122.279778, 47.507658], [-122.279912, 47.507606], [-122.280071, 47.507553], [-122.280214, 47.507511], [-122.28038, 47.507471], [-122.280551, 47.507438], [-122.280849, 47.507397], [-122.28124, 47.507368], [-122.28783, 47.507032], [-122.288091, 47.50701], [-122.288336, 47.506977], [-122.288556, 47.506934], [-122.28877, 47.506876], [-122.288957, 47.506813], [-122.289135, 47.506739], [-122.289304, 47.506655], [-122.289462, 47.506562], [-122.289608, 47.506461], [-122.289728, 47.506363], [-122.289848, 47.506247], [-122.289954, 47.506125], [-122.290045, 47.505997], [-122.290119, 47.505865], [-122.290177, 47.505729], [-122.290218, 47.50559], [-122.290243, 47.50545], [-122.290249, 47.505308], [-122.290238, 47.505167], [-122.290211, 47.505027], [-122.290159, 47.504862], [-122.290091, 47.504692], [-122.288987, 47.502201], [-122.288843, 47.501844], [-122.288775, 47.501642], [-122.288711, 47.501419], [-122.288304, 47.49982], [-122.288247, 47.49963], [-122.288182, 47.499446], [-122.288096, 47.499244], [-122.287986, 47.499023], [-122.287858, 47.498805], [-122.287715, 47.498593], [-122.287589, 47.498426], [-122.287454, 47.498263], [-122.287308, 47.498104], [-122.287154, 47.497949], [-122.28699, 47.497798], [-122.28684, 47.49767], [-122.28666, 47.497528], [-122.286472, 47.497391], [-122.286175, 47.497196], [-122.285855, 47.497009], [-122.284704, 47.496407], [-122.284374, 47.496226], [-122.284059, 47.496032], [-122.283802, 47.495847], [-122.283673, 47.495742], [-122.28355, 47.495633], [-122.283434, 47.49552], [-122.283311, 47.495388], [-122.283211, 47.495269], [-122.283118, 47.495147], [-122.283022, 47.495005], [-122.282946, 47.494878], [-122.282852, 47.494693], [-122.282774, 47.494504], [-122.282719, 47.494335], [-122.282662, 47.494108], [-122.282598, 47.493778], [-122.282136, 47.491139], [-122.28209, 47.490906], [-122.282035, 47.490688], [-122.281988, 47.490538], [-122.281932, 47.490388], [-122.281868, 47.490241], [-122.281796, 47.490095], [-122.281642, 47.489829], [-122.281547, 47.489688], [-122.281446, 47.489551], [-122.281237, 47.489302], [-122.281003, 47.489064], [-122.280757, 47.488847], [-122.280462, 47.488618], [-122.274549, 47.484487], [-122.27415, 47.484196], [-122.274004, 47.484079], [-122.273882, 47.483973], [-122.273766, 47.483863], [-122.273658, 47.483751], [-122.273557, 47.483635], [-122.273463, 47.483516], [-122.273377, 47.483395], [-122.273299, 47.483273], [-122.273229, 47.483148], [-122.273166, 47.483021], [-122.273072, 47.482781], [-122.273033, 47.48265], [-122.273002, 47.482518], [-122.27298, 47.482385], [-122.272965, 47.482252], [-122.27296, 47.482041], [-122.272975, 47.481811], [-122.273008, 47.481563], [-122.273128, 47.480823], [-122.273148, 47.480647], [-122.273159, 47.48045], [-122.273153, 47.48021], [-122.27313, 47.479991], [-122.273091, 47.479774], [-122.273028, 47.479537], [-122.272969, 47.479367], [-122.272909, 47.479219], [-122.272831, 47.479051], [-122.272738, 47.478871], [-122.270479, 47.474799], [-122.270343, 47.474532], [-122.270215, 47.474263], [-122.270095, 47.473993], [-122.269983, 47.47372], [-122.269851, 47.473368], [-122.269732, 47.473014], [-122.269626, 47.472658], [-122.269534, 47.4723], [-122.268944, 47.469504], [-122.268896, 47.469247], [-122.268872, 47.46907], [-122.26885, 47.468742], [-122.268855, 47.468436], [-122.268984, 47.46701], [-122.269009, 47.466818], [-122.269044, 47.466656], [-122.269088, 47.46652], [-122.269143, 47.466398], [-122.269195, 47.466305], [-122.269255, 47.466215], [-122.269322, 47.466127], [-122.269397, 47.466041], [-122.269479, 47.465959], [-122.269568, 47.46588], [-122.269664, 47.465806], [-122.269766, 47.465734], [-122.269873, 47.465667], [-122.269987, 47.465605], [-122.270105, 47.465547], [-122.270229, 47.465493], [-122.270357, 47.465445], [-122.270488, 47.465402], [-122.270624, 47.465364], [-122.270762, 47.465332], [-122.270943, 47.465298], [-122.271128, 47.465274], [-122.271325, 47.465258], [-122.271537, 47.465251], [-122.271771, 47.465251], [-122.27198, 47.46526], [-122.272213, 47.465278], [-122.272444, 47.465305], [-122.272697, 47.465346], [-122.272974, 47.465403], [-122.274904, 47.46586], [-122.275199, 47.465926], [-122.275569, 47.465992], [-122.275943, 47.466039], [-122.276145, 47.466056], [-122.276378, 47.466068], [-122.276612, 47.466073], [-122.276816, 47.466071], [-122.27705, 47.466062], [-122.277253, 47.466048], [-122.277455, 47.466028], [-122.277685, 47.465998], [-122.277968, 47.46595], [-122.278219, 47.465898], [-122.278465, 47.465837], [-122.278747, 47.465756], [-122.279035, 47.465664], [-122.279317, 47.465564], [-122.279592, 47.465456], [-122.279831, 47.465352], [-122.280064, 47.465243], [-122.280262, 47.465142], [-122.280455, 47.465037], [-122.280643, 47.464928], [-122.280893, 47.46477], [-122.281651, 47.464261], [-122.281807, 47.464163], [-122.281967, 47.46407], [-122.282156, 47.463968], [-122.282352, 47.463873], [-122.282555, 47.463784], [-122.282763, 47.463701], [-122.28303, 47.463607], [-122.283278, 47.463531], [-122.283531, 47.463464], [-122.283788, 47.463406], [-122.284079, 47.463352], [-122.284345, 47.463314], [-122.284643, 47.463282], [-122.284913, 47.463263], [-122.285245, 47.463253], [-122.285498, 47.463263], [-122.285626, 47.463276], [-122.285754, 47.463295], [-122.285879, 47.463319], [-122.286019, 47.463354], [-122.286155, 47.463395], [-122.286355, 47.463463], [-122.289014, 47.464415], [-122.28917, 47.464465], [-122.289331, 47.46451], [-122.289492, 47.464544], [-122.289637, 47.464568], [-122.289784, 47.464584], [-122.289932, 47.464592], [-122.290081, 47.464594], [-122.290339, 47.46458], [-122.290597, 47.464544], [-122.290858, 47.464489], [-122.291079, 47.464428], [-122.291405, 47.464321], [-122.291622, 47.464239], [-122.291833, 47.464151], [-122.292039, 47.464057], [-122.292238, 47.463957], [-122.292431, 47.463852], [-122.292717, 47.463676], [-122.293012, 47.46347], [-122.293361, 47.463201], [-122.29878, 47.458922], [-122.299187, 47.458592], [-122.299442, 47.458364], [-122.29965, 47.458149], [-122.299773, 47.458006], [-122.299887, 47.457858], [-122.299991, 47.457708], [-122.300086, 47.457554], [-122.30017, 47.457398], [-122.300245, 47.45724], [-122.300309, 47.457079], [-122.300363, 47.456917], [-122.300406, 47.456753], [-122.300455, 47.456471], [-122.300481, 47.456114], [-122.300507, 47.453066], [-122.300486, 47.452773], [-122.30046, 47.452611], [-122.300424, 47.452451], [-122.300377, 47.452291], [-122.300319, 47.452133], [-122.300252, 47.451977], [-122.300174, 47.451824], [-122.300086, 47.451673], [-122.299988, 47.451524], [-122.299881, 47.451379], [-122.299764, 47.451237], [-122.299638, 47.451099], [-122.299503, 47.450964], [-122.299285, 47.450772], [-122.298999, 47.450553], [-122.298739, 47.450379], [-122.297973, 47.449886], [-122.297787, 47.449758], [-122.297638, 47.44964], [-122.297539, 47.449549], [-122.297449, 47.449455], [-122.297369, 47.449356], [-122.297298, 47.449254], [-122.297237, 47.449149], [-122.297187, 47.449041], [-122.297146, 47.448932], [-122.297116, 47.448821], [-122.297088, 47.448615], [-122.297081, 47.448412], [-122.297066, 47.446826], [-122.29705, 47.446418], [-122.296812, 47.443146], [-122.296786, 47.442726], [-122.296744, 47.441422], [-122.296688, 47.440388], [-122.296678, 47.440102], [-122.296661, 47.43945], [-122.296663, 47.439179], [-122.296675, 47.438994], [-122.296696, 47.438809], [-122.296728, 47.438624], [-122.296769, 47.43844], [-122.29682, 47.438258], [-122.296914, 47.437979], [-122.297377, 47.436733], [-122.297456, 47.436471], [-122.297521, 47.436176], [-122.2978, 47.434387], [-122.297854, 47.433988], [-122.2979, 47.433588], [-122.297935, 47.433188], [-122.297961, 47.432787], [-122.297978, 47.432386], [-122.297984, 47.431986], [-122.297982, 47.431584], [-122.297969, 47.431184], [-122.297948, 47.430783], [-122.297848, 47.429342], [-122.297678, 47.426376], [-122.297666, 47.426058], [-122.297666, 47.42584], [-122.297685, 47.425406], [-122.297868, 47.423236], [-122.297872, 47.422995], [-122.297856, 47.422156], [-122.297838, 47.421339], [-122.297829, 47.421189], [-122.297797, 47.420925], [-122.29775, 47.420681], [-122.297668, 47.420333], [-122.297363, 47.418071], [-122.297313, 47.417741], [-122.297254, 47.417461], [-122.2972, 47.417261], [-122.297135, 47.417062], [-122.29706, 47.416866], [-122.296975, 47.416671], [-122.29688, 47.416478], [-122.296775, 47.416287], [-122.29666, 47.416099], [-122.296536, 47.415914], [-122.296402, 47.415732], [-122.296259, 47.415554], [-122.296106, 47.415379], [-122.295945, 47.415207], [-122.295775, 47.41504], [-122.295597, 47.414877], [-122.29541, 47.414718], [-122.295245, 47.414586], [-122.294181, 47.41377], [-122.294001, 47.413623], [-122.293846, 47.413486], [-122.293626, 47.413275], [-122.293423, 47.413057], [-122.293297, 47.412908], [-122.293123, 47.412678], [-122.293017, 47.412521], [-122.292872, 47.412282], [-122.292787, 47.41212], [-122.292674, 47.411873], [-122.292609, 47.411707], [-122.292528, 47.411454], [-122.292467, 47.4112], [-122.292425, 47.410943], [-122.292404, 47.410685], [-122.292402, 47.410426], [-122.29242, 47.410168], [-122.292448, 47.409965], [-122.293077, 47.406757], [-122.293351, 47.405328], [-122.293389, 47.405082], [-122.293467, 47.404439], [-122.293495, 47.404113], [-122.293518, 47.403737], [-122.293534, 47.403123], [-122.293522, 47.402486], [-122.293503, 47.402145], [-122.293478, 47.40182], [-122.293443, 47.401472], [-122.29336, 47.400865], [-122.293261, 47.40031], [-122.293141, 47.399762], [-122.292926, 47.398855], [-122.292821, 47.398381], [-122.292729, 47.397907], [-122.292648, 47.397432], [-122.29258, 47.396956], [-122.292524, 47.396479], [-122.29248, 47.396001], [-122.292406, 47.394779], [-122.292393, 47.394373], [-122.292399, 47.394191], [-122.292415, 47.39401], [-122.292456, 47.393738], [-122.292495, 47.393559], [-122.292543, 47.39338], [-122.2926, 47.393202], [-122.292666, 47.393026], [-122.292742, 47.392852], [-122.292826, 47.392679], [-122.292969, 47.392424], [-122.293106, 47.39221], [-122.294084, 47.390801], [-122.294182, 47.390633], [-122.29423, 47.390527], [-122.294273, 47.390414], [-122.29431, 47.390282], [-122.294685, 47.388754], [-122.294717, 47.388579], [-122.294725, 47.388477], [-122.294723, 47.388374], [-122.294712, 47.388273], [-122.294692, 47.388171], [-122.294663, 47.388071], [-122.2946, 47.387922], [-122.294511, 47.387756], [-122.293438, 47.3859], [-122.29328, 47.38561], [-122.293104, 47.385247], [-122.291812, 47.382421], [-122.291703, 47.382137], [-122.29164, 47.38194], [-122.291587, 47.381743], [-122.291545, 47.381544], [-122.291513, 47.381344], [-122.291491, 47.381144], [-122.291479, 47.380943], [-122.291478, 47.380742], [-122.291495, 47.380441], [-122.29152, 47.38024], [-122.291559, 47.380019], [-122.29162, 47.379756], [-122.295828, 47.363363], [-122.295935, 47.36297], [-122.296008, 47.362735], [-122.296116, 47.362414], [-122.296551, 47.361224], [-122.296645, 47.360986], [-122.296729, 47.360803], [-122.29681, 47.360643], [-122.297904, 47.358591], [-122.297957, 47.35847], [-122.297993, 47.358359], [-122.298015, 47.358256], [-122.298026, 47.358153], [-122.298028, 47.358049], [-122.298018, 47.357945], [-122.297977, 47.357766], [-122.297926, 47.357624], [-122.297608, 47.356821], [-122.297559, 47.356676], [-122.29751, 47.356496], [-122.297461, 47.356219], [-122.297374, 47.355341], [-122.297335, 47.355028], [-122.297286, 47.354716], [-122.297227, 47.354405], [-122.297157, 47.354095], [-122.297077, 47.353786], [-122.296986, 47.353479], [-122.296885, 47.353172], [-122.296774, 47.352868], [-122.296653, 47.352565], [-122.296521, 47.352265], [-122.296297, 47.351801], [-122.294599, 47.348428], [-122.294472, 47.348163], [-122.294253, 47.347658], [-122.29406, 47.347149], [-122.293973, 47.346892], [-122.293893, 47.346635], [-122.293753, 47.346117], [-122.293639, 47.345596], [-122.293593, 47.345335], [-122.293553, 47.345073], [-122.293493, 47.344549], [-122.29346, 47.344023], [-122.293453, 47.34376], [-122.293461, 47.343233], [-122.293483, 47.342863], [-122.294887, 47.32627], [-122.294925, 47.325952], [-122.29525, 47.32362], [-122.2953, 47.323302], [-122.295345, 47.323065], [-122.295452, 47.322592], [-122.295557, 47.322213], [-122.296107, 47.32042], [-122.296161, 47.320254], [-122.296253, 47.320004], [-122.296665, 47.319053], [-122.296779, 47.318821], [-122.296865, 47.318685], [-122.296958, 47.318563], [-122.297092, 47.318416], [-122.297212, 47.318305], [-122.297343, 47.3182], [-122.297522, 47.318078], [-122.297715, 47.317967], [-122.29788, 47.317887], [-122.298052, 47.317815], [-122.298277, 47.317736], [-122.298512, 47.317671], [-122.298754, 47.31762], [-122.298952, 47.31759], [-122.299102, 47.317574], [-122.299441, 47.317557], [-122.301342, 47.317563], [-122.301669, 47.317554], [-122.301828, 47.317539], [-122.301969, 47.317519], [-122.302108, 47.317493], [-122.302244, 47.31746], [-122.302376, 47.317421], [-122.302504, 47.317375], [-122.302628, 47.317325], [-122.302746, 47.317268], [-122.302858, 47.317206], [-122.302964, 47.31714], [-122.303063, 47.317068], [-122.303155, 47.316992], [-122.303239, 47.316913], [-122.303314, 47.316829], [-122.303387, 47.316735], [-122.303466, 47.31662], [-122.304152, 47.31554]]},
            properties:{title:'Link Line',description:'Link Line 1'}}
        ]
    }

    const canvas = map.getCanvasContainer();

    map.on('load',() => {
        // Make pointer default
        map.getCanvas().style.cursor = 'default';

        // add tilesets
        map.addSource('s_seattle_st', {
            'type': 'vector',
            'url': 'mapbox://blumdrew.s_seattle_st_v3' // change as needed
        });
        map.addSource('s_seattle_route',{
            'type':'vector',
            'url':'mapbox://blumdrew.s_seattle_st_routesv1' // change as needed
        })
        map.addSource('s_seattle_link',{
            'type':'geojson',
            'data':southEndLink
        })
        map.addSource('s_seattle_link_route',{
            'type':'geojson',
            'data':linkRoute
        })
        map.addLayer({
                'id': 'hex-fill',
                'source': 's_seattle_st',
                'source-layer': 's_seattle_hex', //change as needed
                'type': 'fill',
                layout: {
                    visibility: 'visible'
                },
                paint: {
                    'fill-color':[
                        'case', ['==',['get','total_duration_link'],null],"#762a83",
                        ['==',['get','total_duration_no_link'],null],"#1b7837",
                        ['interpolate',
                        ['linear'],
                        ['get','td_ratio'],
                        0.66, "#1b7837",
                        0.85, "#7fbf7b",
                        0.95, "#d9f0d3",
                        1, "#f7f7f7",
                        1.05, "#e7d4e8",
                        1.15, "#af8dc3",
                        100, "#762a83"]],
                    'fill-opacity':0.33
                }
            },
            'continent-label' // Add layer below labels
        );
        map.addLayer({
                'id':'hex-outline',
                'source':'s_seattle_st',
                'source-layer': 's_seattle_hex',
                'type':'line',
                layout: {
                    visibility: 'none'
                },
                'paint':{'line-color':"#ffffff"}
            },
            'continent-label' // Add layer below labels
        );
        map.addLayer({
                'id':'hex-route',
                'source':'s_seattle_route',
                'source-layer': 's_seattle_hex',
                'type':'line',
                'filter':['all',
                    ['==',['get','label'],'total_duration_link'],
                    ['==',['get','hex_id'],40]
                ],
                layout: {
                    "visibility": 'visible'
                },
                'paint':{
                    'line-color':[
                        "case",['==',['get','transitRouteStep'],'1 Line'],'#28813F',
                        ['==',['get','transitRouteStep'],'Walk'],'#add8e6',
                        '#FFB819'
                    ],
                    'line-width':2
                }
            },
            'continent-label' // Add layer below labels
        );
        map.addLayer({
            'id':'hex-route-label',
            'source':'s_seattle_route',
            'source-layer':'s_seattle_hex',
            'type':'symbol',
            'layout': {
                'text-field': ['get', 'transitRouteStep'],
                'symbol-placement':"line",
                'symbol-spacing':250,
                'icon-allow-overlap':true,
                'text-allow-overlap':true,
                'icon-ignore-placement':true,
                'text-ignore-placement':true,
                visibility: 'none',
            },
            paint:{
                'text-color':'#000000',
                "text-halo-color": [
                    "case",['==',['get','transitRouteStep'],'1 Line'],'#28813F',
                    ['==',['get','transitRouteStep'],'Walk'],'#add8e6',
                    '#FFB819'
                ],
                "text-halo-width": 30,
                "text-halo-blur":10
            }
        })
        map.addLayer({
            'id':'south-end-link',
            'source':'s_seattle_link',
            'type':'circle',
            paint: {
                'circle-radius': 3,
                'circle-color': '#28813F'
            },
            'layout':{visibility: 'none'}
        });
        map.addLayer({
            'id': 'south-end-link-labels',
            'type': 'symbol',
            'source': 's_seattle_link',
            'layout': {
                'text-field': ['get', 'description'],
                'text-variable-anchor': ['top', 'bottom', 'left', 'right'],
                'text-radial-offset': 0.5,
                'text-justify': 'auto',
                visibility: 'none',
                'text-size':10
            },
            paint:{'text-color':'#ffffff'}
        });
        map.addLayer({
            'id':'south-end-link-route',
            'source':'s_seattle_link_route',
            'type':'line',
            paint: {'line-color': '#28813F'},
            'layout':{visibility: 'none'}
        },'continent-label');
    })

    var currentlyClickedProperties = [];
    map.on("click", (e) => {
        var hexSelected = map.queryRenderedFeatures(e.point,{layers:['hex-fill']});
        var properties = hexSelected.map(hexSelected => hexSelected.properties);
        currentlyClickedProperties = properties;
        var currentSelection = document.getElementById('chinatown-region').value;
        if (properties.length != 0) {
            // write in legend
            var link_duration;
            var no_link_duration;
            var cid_str;
            if (currentSelection == '99') {
                link_duration = Math.round(properties[0].total_duration_link / 60);
                no_link_duration = Math.round(properties[0].total_duration_no_link / 60);
                cid_str = 'C/ID';
            } else if (currentSelection == '0'){
                link_duration = Math.round(properties[0].total_duration_0_link / 60);
                no_link_duration = Math.round(properties[0].total_duration_0_no_link / 60);
                cid_str = '6th/King';
            } else if (currentSelection == '1'){
                link_duration = Math.round(properties[0].total_duration_1_link / 60);
                no_link_duration = Math.round(properties[0].total_duration_1_no_link / 60);
                cid_str = '7th/King';
            } else if (currentSelection == '2'){
                link_duration = Math.round(properties[0].total_duration_2_link / 60);
                no_link_duration = Math.round(properties[0].total_duration_2_no_link / 60);
                cid_str = '6th/Lane';
            } else if (currentSelection == '3'){
                link_duration = Math.round(properties[0].total_duration_3_link / 60);
                no_link_duration = Math.round(properties[0].total_duration_3_no_link / 60);
                cid_str = '7th/Lane';
            }
            var firstLine = isNaN(link_duration) ? `No trips with Link given to ${cid_str}`:0;
            firstLine = firstLine == 0 ? `Using Link to ${cid_str} ${(link_duration <= no_link_duration) ? "saves":"loses"} ${Math.abs(link_duration - no_link_duration)} minutes`: firstLine
            var displayString = `
            ${firstLine}
            <br><br>
            Travel time to ${cid_str} with Link: ${isNaN(link_duration) ? 'Not Calculated':`${link_duration} minutes`}
            <br><br>
            Travel time to ${cid_str} without Link: ${no_link_duration} minutes
            `;
            document.getElementById('south-end-marker-text').innerHTML = displayString;
            // render route for hex
            var hexRouteFilter;
            if (link_duration <= no_link_duration) {
                hexRouteFilter = ['all',
                    ['==',['get','label'],`total_duration${currentSelection == '99'? '':'_'+currentSelection}_link`],
                    ['==',['get','hex_id'],properties[0].hex_id]
                ]
            } else {
                hexRouteFilter = ['all',
                    ['==',['get','label'],`total_duration${currentSelection == '99'? '':'_'+currentSelection}_no_link`],
                    ['==',['get','hex_id'],properties[0].hex_id]
                ]
            }
            map.setFilter('hex-route',hexRouteFilter);
            map.setFilter('hex-route-label',hexRouteFilter);
            // set white outline on hex
            map.setFilter('hex-outline',['==', 'hex_id', properties[0].hex_id]);
            map.setLayoutProperty('hex-outline','visibility','visible');
        } else {
            // reset all
            map.setLayoutProperty('hex-outline','visibility','none');
            document.getElementById('south-end-marker-text').innerHTML = '<i>Click on a hexagon to show details for a specific part of Seattle\'s South End</i>';
            map.setLayoutProperty('hex-route','visibility','none');
            map.setLayoutProperty('hex-route-label','visibility','none');
            currentlyClickedProperties = [];
        }
    })

    
    map.on("idle", () =>{
        var fillColor;
        var currentSelection = document.getElementById('chinatown-region').value;
        if (currentSelection == '99') {
            fillColor = [
                'case', ['==',['get','total_duration_link'],null],"#762a83",
                ['==',['get','total_duration_no_link'],null],"#1b7837",
                ['interpolate',
                ['linear'],
                ['get','td_ratio'],
                0.66, "#1b7837",
                0.85, "#7fbf7b",
                0.95, "#d9f0d3",
                1, "#f7f7f7",
                1.05, "#e7d4e8",
                1.15, "#af8dc3",
                100, "#762a83"]
            ]
        } else {
           fillColor = [
                'case', ['==',['get',`total_duration_${currentSelection}_link`],null],"#762a83",
                ['==',['get',`total_duration_${currentSelection}_no_link`],null],"#1b7837",
                ['interpolate',
                ['linear'],
                ['get',`td_ratio_${currentSelection}`],
                0.66, "#1b7837",
                0.85, "#7fbf7b",
                0.95, "#d9f0d3",
                1, "#f7f7f7",
                1.05, "#e7d4e8",
                1.15, "#af8dc3",
                100, "#762a83"]
            ]
        }
        map.setPaintProperty('hex-fill', 'fill-color', fillColor);
        var properties = currentlyClickedProperties;
        if (properties.length != 0){
            var link_duration;
            var no_link_duration;
            var cid_str;
            if (currentSelection == '99') {
                link_duration = Math.round(properties[0].total_duration_link / 60);
                no_link_duration = Math.round(properties[0].total_duration_no_link / 60);
                cid_str = 'C/ID';
            } else if (currentSelection == '0'){
                link_duration = Math.round(properties[0].total_duration_0_link / 60);
                no_link_duration = Math.round(properties[0].total_duration_0_no_link / 60);
                cid_str = '6th/King';
            } else if (currentSelection == '1'){
                link_duration = Math.round(properties[0].total_duration_1_link / 60);
                no_link_duration = Math.round(properties[0].total_duration_1_no_link / 60);
                cid_str = '7th/King';
            } else if (currentSelection == '2'){
                link_duration = Math.round(properties[0].total_duration_2_link / 60);
                no_link_duration = Math.round(properties[0].total_duration_2_no_link / 60);
                cid_str = '6th/Lane';
            } else if (currentSelection == '3'){
                link_duration = Math.round(properties[0].total_duration_3_link / 60);
                no_link_duration = Math.round(properties[0].total_duration_3_no_link / 60);
                cid_str = '7th/Lane';
            }
            var firstLine = isNaN(link_duration) ? `No trips with Link given to ${cid_str}`:0;
            firstLine = firstLine == 0 ? `Using Link to ${cid_str} ${(link_duration <= no_link_duration) ? "saves":"loses"} ${Math.abs(link_duration - no_link_duration)} minutes`: firstLine
            var displayString = `
            ${firstLine}
            <br><br>
            Travel time to ${cid_str} with Link: ${isNaN(link_duration) ? 'Not Calculated':`${link_duration} minutes`}
            <br><br>
            Travel time to ${cid_str} without Link: ${no_link_duration} minutes
            `;
            document.getElementById('south-end-marker-text').innerHTML = displayString;
            // update route
            var hexRouteFilter;
            if (link_duration <= no_link_duration) {
                hexRouteFilter = ['all',
                    ['==',['get','label'],`total_duration${currentSelection == '99'? '':'_'+currentSelection}_link`],
                    ['==',['get','hex_id'],properties[0].hex_id]
                ]
            } else {
                hexRouteFilter = ['all',
                    ['==',['get','label'],`total_duration${currentSelection == '99'? '':'_'+currentSelection}_no_link`],
                    ['==',['get','hex_id'],properties[0].hex_id]
                ]
            }
            map.setFilter('hex-route',hexRouteFilter);
            map.setFilter('hex-route-label',hexRouteFilter);
        } else {
            document.getElementById('south-end-marker-text').innerHTML = '<i>Click on a hexagon to show details for a specific part of Seattle\'s South End</i>'
        }
        var routeCheck = document.getElementById('show-link').checked;
        var labelCheck = document.getElementById('show-link-labels').checked;
        if (routeCheck == true) {
            if (properties.length != 0){
                map.setLayoutProperty('south-end-link', 'visibility', 'none');
                map.setLayoutProperty('south-end-link-route', 'visibility', 'none');
                map.setLayoutProperty('hex-route','visibility','visible');
                map.setLayoutProperty('south-end-link-labels','visibility','none');
                if (labelCheck == true){
                    map.setLayoutProperty('hex-route-label','visibility','visible');
                } else {
                    map.setLayoutProperty('hex-route-label','visibility','none');
                }
            } else {
                map.setLayoutProperty('south-end-link', 'visibility', 'visible');
                map.setLayoutProperty('south-end-link-route', 'visibility', 'visible');
                map.setLayoutProperty('hex-route','visibility','none');
                if (labelCheck == true){
                    map.setLayoutProperty('south-end-link-labels','visibility','visible');
                } else {
                    map.setLayoutProperty('south-end-link-labels','visibility','none');
                }
            }
            
        } else {
            map.setLayoutProperty('south-end-link', 'visibility', 'none');
            map.setLayoutProperty('south-end-link-route', 'visibility', 'none');
            map.setLayoutProperty('south-end-link-labels', 'visibility', 'none');
            map.setLayoutProperty('hex-route','visibility','none');
        }
    })
    map.addControl(new mapboxgl.AttributionControl({
        customAttribution: 'Map: <a href=https://city-hikes.com/>Andrew Lindstrom<a> | Sources: Sound Transit, King County Metro Transit, Google'
    }));
    
</script>

</body>
</html>